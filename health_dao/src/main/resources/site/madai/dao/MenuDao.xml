<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="site.madai.dao.MenuDao">
    <sql id="all">
        `id`, `name`, `linkUrl`, `path`, `priority`, `icon`, `description`, `parentMenuId`
    </sql>

    <!--基本属性-->
    <resultMap id="baseMap" type="menu">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="linkUrl" property="linkUrl"/>
        <result column="path" property="path"/>
        <result column="priority" property="priority"/>
        <result column="icon" property="icon"/>
        <result column="description" property="description"/>
        <result column="parentMenuId" property="parentMenuId"/>
        <result column="level" property="level"/>
    </resultMap>

    <!--菜单自关联属性-->
    <resultMap id="getMenusByRoleIdMap" type="menu"
               extends="baseMap">
        <collection property="children" column="id" ofType="menu"
                    select="getSMenusByFMenuId"/>
    </resultMap>

    <select id="getMenusByUsername" parameterType="string"
            resultMap="getMenusByRoleIdMap">
        select
        <include refid="all"/>
         from t_menu where level = 1 and id in
         (select menu_id from t_role_menu where role_id in (select role_id
        from t_user_role where user_id in (select id from t_user where
        username = #{username})))
    </select>

    <select id="getSMenusByFMenuId" parameterType="int"
            resultType="menu">
        select
        <include refid="all"/>
        from t_menu where level = 2 and parentMenuId = #{parentMenuId}
    </select>

</mapper>